<!doctype html>
<html>

<head>
    <title>SkyBlock Meta Tree</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
    <svg id="canvas"></svg>
    <script>
        // meta tree data

        const data = {
            "name": "New Profile",
            "helmet": "-",
            "chestplate": "-",
            "leggings": "-",
            "boots": "-",
            "pet": "-",
            "main_weapon": "-",
            "min_skill1": "-",
            "min_skill2": "-",
            "min_skill3": "-",
            "ability_item1": "-",
            "ability_item2": "-",
            "ability_item3": "-",
            "ability_item4": "-",
            "money": "Wheat - 30k/h",
            "children": [{
                "name": "Rookie",
                "helmet": "&cFarmer Suit",
                "chestplate": "&cFarmer Suit",
                "leggings": "&cFarmer Suit",
                "boots": "&cFarmer Suit",
                "pet": "&cBee",
                "main_weapon": "&cUndead Sword",
                "ability_item1": "&cIron Pickaxe",
                "ability_item2": "&cRookie Hoe",
                "money": "Wheat - 40k/h",
                "children": [{
                    "name": "Fighter",
                    "helmet": "&uSquire Armor",
                    "chestplate": "&uSquire Armor",
                    "leggings": "&uSquire Armor",
                    "boots": "&uSquire Armor",
                    "pet": "&cBee",
                    "main_weapon": "&uSquire Sword",
                    "min_skill1": "Combat 5",
                    "min_skill2": "-",
                    "min_skill3": "70 Fairy Souls",
                    "ability_item1": "&uRadiant Power Orb",
                    "ability_item2": "&uWand of Healing",
                    "children": [{
                        "name": "Kuudra",
                        "children": [{
                            "name": "t1 Cannonier",
                            "children": [{
                                "name": "t2 Cannonier",
                            }],
                        }, {
                            "name": "t1 Mage",
                            "children": [{
                                "name": "t2 Mage",
                            }, {
                                "name": "t2 Archer",
                            }],
                        }],
                    }, {
                        "name": "Slayer - t1 Rev",
                        "helmet": "&uSquire Armor",
                        "chestplate": "&uSquire Armor",
                        "leggings": "&uSquire Armor",
                        "boots": "&uSquire Armor",
                        "pet": "Bee",
                        "main_weapon": "&uSquire Sword",
                        "min_skill1": "Combat 5",
                        "min_skill2": "-",
                        "min_skill3": "70 Fairy Souls",
                        "children": [{
                            "name": "t2 Rev",
                            "helmet": "&uSquire Armor",
                            "chestplate": "&uSquire Armor",
                            "leggings": "&uSquire Armor",
                            "boots": "&uSquire Armor",
                            "pet": "Bee",
                            "main_weapon": "&uSquire Sword",
                            "min_skill1": "Combat 10",
                            "min_skill2": "-",
                            "min_skill3": "100 Fairy Souls",
                            "ability_item1": "&uWand of Healing",
                            "children": [{
                                "name": "t3 Rev",
                                "children": [{
                                    "name": "t4 Rev",
                                    "children": [{
                                        "name": "t5 Rev",
                                    }],
                                }],
                            }, {
                                "name": "t1 Tara",
                                "children": [{
                                    "name": "t2 Tara",
                                    "children": [{
                                        "name": "t3 Tara",
                                        "children": [{
                                            "name": "t4 Tara",
                                        }],
                                    }, {
                                        "name": "t1 Sven",
                                        "children": [{
                                            "name": "t2 Sven",
                                            "children": [{
                                                "name": "t3 Sven",
                                                "children": [{
                                                    "name": "t4 Sven",
                                                    "children": [{
                                                        "name": "t1 Voidgloom",
                                                        "children": [{
                                                            "name": "t2 Voidgloom",
                                                            "children": [{
                                                                "name": "t3 Voidgloom",
                                                                "children": [{
                                                                    "name": "t4 Voidgloom",
                                                                }, {
                                                                    "name": "t1 Inferno",
                                                                    "children": [{
                                                                        "name": "t2 Inferno",
                                                                        "children": [{
                                                                            "name": "t3 Inferno",
                                                                            "children": [{
                                                                                "name": "t4 Inferno",
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],

                            }]
                        }]
                    }, {
                        "name": "Dungeoneer",
                        "helmet": "&eEnder Armor",
                        "chestplate": "&eEnder Armor",
                        "leggings": "&eEnder Armor",
                        "boots": "&eEnder Armor",
                        "pet": "&eEnderman",
                        "main_weapon": "&rRaiders Axe",
                        "min_skill1": "Combat 15",
                        "min_skill2": "-",
                        "min_skill3": "120 Fairy Souls",
                        "ability_item1": "&uRadiant Power Orb",
                        "ability_item2": "&uWand of Healing",
                        "ability_item3": "&cEnder Pearls",
                        "ability_item4": "-",
                        "children": [{
                            "name": "f1 Healer",
                            "children": [{
                                "name": "f2 Healer",
                                "children": [{
                                    "name": "f3 Healer",
                                    "children": [{
                                        "name": "f4 Healer",
                                        "children": [{
                                            "name": "f5 Healer",
                                            "children": [{
                                                "name": "f6 Healer",
                                                "children": [{
                                                    "name": "f7 Healer",
                                                    "children": [{
                                                        "name": "m1 Healer",
                                                        "children": [{
                                                            "name": "m2 Healer",
                                                            "children": [{
                                                                "name": "m3 Healer",
                                                                "children": [{
                                                                    "name": "m4 Healer",
                                                                    "children": [{
                                                                        "name": "m5 Healer",
                                                                        "children": [{
                                                                            "name": "m6 Healer",
                                                                            "children": [{
                                                                                "name": "m7 Healer"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }, {
                            "name": "f1 Mage",
                            "children": [{
                                "name": "f2 Mage",
                                "children": [{
                                    "name": "f3 Mage",
                                    "children": [{
                                        "name": "f4 Mage",
                                        "children": [{
                                            "name": "f5 Mage",
                                            "children": [{
                                                "name": "f6 Mage",
                                                "children": [{
                                                    "name": "f7 Mage",
                                                    "children": [{
                                                        "name": "m1 Mage",
                                                        "children": [{
                                                            "name": "m2 Mage",
                                                            "children": [{
                                                                "name": "m3 Mage",
                                                                "children": [{
                                                                    "name": "m4 Mage",
                                                                    "children": [{
                                                                        "name": "m5 Mage",
                                                                        "children": [{
                                                                            "name": "m6 Mage",
                                                                            "children": [{
                                                                                "name": "m7 Mage"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }, {
                            "name": "f1 Berserk",
                            "children": [{
                                "name": "f2 Berserk",
                                "children": [{
                                    "name": "f3 Berserk",
                                    "children": [{
                                        "name": "f4 Berserk",
                                        "children": [{
                                            "name": "f5 Berserk",
                                            "children": [{
                                                "name": "f6 Berserk",
                                                "children": [{
                                                    "name": "f7 Berserk",
                                                    "children": [{
                                                        "name": "m1 Berserk",
                                                        "children": [{
                                                            "name": "m2 Berserk",
                                                            "children": [{
                                                                "name": "m3 Berserk",
                                                                "children": [{
                                                                    "name": "m4 Berserk",
                                                                    "children": [{
                                                                        "name": "m5 Berserk",
                                                                        "children": [{
                                                                            "name": "m6 Berserk",
                                                                            "children": [{
                                                                                "name": "m7 Berserk"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }, {
                            "name": "f1 Archer",
                            "children": [{
                                "name": "f2 Archer",
                                "children": [{
                                    "name": "f3 Archer",
                                    "children": [{
                                        "name": "f4 Archer",
                                        "children": [{
                                            "name": "f5 Archer",
                                            "children": [{
                                                "name": "f6 Archer",
                                                "children": [{
                                                    "name": "f7 Archer",
                                                    "children": [{
                                                        "name": "m1 Archer",
                                                        "children": [{
                                                            "name": "m2 Archer",
                                                            "children": [{
                                                                "name": "m3 Archer",
                                                                "children": [{
                                                                    "name": "m4 Archer",
                                                                    "children": [{
                                                                        "name": "m5 Archer",
                                                                        "children": [{
                                                                            "name": "m6 Archer",
                                                                            "children": [{
                                                                                "name": "m7 Archer"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }, {
                            "name": "f1 Tank",
                            "children": [{
                                "name": "f2 Tank",
                                "children": [{
                                    "name": "f3 Tank",
                                    "children": [{
                                        "name": "f4 Tank",
                                        "children": [{
                                            "name": "f5 Tank",
                                            "children": [{
                                                "name": "f6 Tank",
                                                "children": [{
                                                    "name": "f7 Tank",
                                                    "children": [{
                                                        "name": "m1 Tank",
                                                        "children": [{
                                                            "name": "m2 Tank",
                                                            "children": [{
                                                                "name": "m3 Tank",
                                                                "children": [{
                                                                    "name": "m4 Tank",
                                                                    "children": [{
                                                                        "name": "m5 Tank",
                                                                        "children": [{
                                                                            "name": "m6 Tank",
                                                                            "children": [{
                                                                                "name": "m7 Tank"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }],
                    }]
                }, {
                    "name": "Gatherer",
                    "helmet": "&cFarmer",
                    "chestplate": "&cFarmer",
                    "leggings": "&cFarmer",
                    "boots": "&cFarmer",
                    "pet": "&cBee",
                    "main_weapon": "&cUndead Sword",
                    "min_skill1": "-",
                    "min_skill2": "-",
                    "min_skill3": "70 Fairy Souls",
                    "ability_item1": "&uDiamond Pickaxe",
                    "ability_item2": "-",
                    "ability_item3": "-",
                    "ability_item4": "-",
                    "children": [{
                        "name": "Miner",
                        "children": [{
                            "name": "Mithril Miner"
                        }],
                    }, {
                        "name": "Farmer",
                        "children": [{
                            "name": "Sugarcane Farmer"
                        }],
                    }]
                }]
            }]
        };

        // variables to alter appearance


        const boxSize = 100;
        const extraBoxWidth = 80;

        const width = window.screen.width * 3;
        const height = window.screen.height * 2;


        // visualize diagram

        const svg = d3.select("svg");

        const client_width = document.body.clientWidth;
        const client_height = document.body.clientHeight;

        const margin = {
            top: 0,
            right: 0,
            bottom: 0,
            left: 0
        };

        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;


        var first = true;
        const scale = Math.min(client_height / (height + boxSize * 2), client_width / width);

        const treeLayout = d3.tree()
            .size([innerWidth, innerHeight]);

        const zoomG = svg
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("class", "zoomG")
            .attr("transform", "translate(" + 0 + "," + 0 + ") scale (" + scale + ")");

        const g = zoomG.append("g")
            .attr("transform", "translate(" + margin.left + "," + (margin.top + boxSize) + ")");

        svg.call(d3.zoom().on("zoom", function(d) {
            if (first) {
                d.transform.k = d.transform.k * scale;
                first = false;
            }
            zoomG.attr("transform", d.transform);
        }));

        const root = d3.hierarchy(data);
        const nodes = root.descendants();
        const links = treeLayout(root).links();
        const linkPathGenerator = d3.linkVertical()
            .x(function(d) {
                return d.x;
            })
            .y(function(d) {
                return height - d.y;
            });

        // paths
        g.selectAll("path").data(links)
            .enter().append("path")
            .attr("d", linkPathGenerator);

        // node
        const rectSize = boxSize;
        var node = g.selectAll(".node").data(nodes).enter();

        // boxes
        node.append("rect")
            .attr("class", "box")
            .attr("rx", rectSize / 15)
            .attr("width", rectSize + extraBoxWidth)
            .attr("height", rectSize)
            .attr("transform", function(d) {
                return "translate(" + (d.x - (rectSize + extraBoxWidth) / 2) + "," + (height - d.y - rectSize / 2) + ")";
            });

        // text
        node.append("text")
            .attr("class", "title")
            .attr("x", function(d) {
                return d.x;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "-2.2em")
            .text(function(d) {
                return d.data.name;
            });

        // helmet
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.helmet);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "-2.7em")
            .text(function(d) {
                return getItemText(d.data.helmet) ?? "-";
            });

        // chestplate
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.chestplate);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "-1.7em")
            .text(function(d) {
                return getItemText(d.data.chestplate) ?? "-";
            });

        // leggings
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.leggings);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "-0.7em")
            .text(function(d) {
                return getItemText(d.data.leggings) ?? "-";
            });

        // boots
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.boots);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "0.3em")
            .text(function(d) {
                return getItemText(d.data.boots) ?? "-";
            });

        // pet
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.pet);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "2.3em")
            .text(function(d) {
                return getItemText(d.data.pet) ?? "-";
            });

        // main_weapon
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.main_weapon);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "4.3em")
            .text(function(d) {
                return getItemText(d.data.main_weapon) ?? "-";
            });

        // min_skill1
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.min_skill1);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "-2.7em")
            .text(function(d) {
                return getItemText(d.data.min_skill1) ?? "-";
            });

        // min_skill2
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.min_skill2);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "-1.7em")
            .text(function(d) {
                return getItemText(d.data.min_skill2) ?? "-";
            });

        // min_skill3
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.min_skill3);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "-0.7em")
            .text(function(d) {
                return getItemText(d.data.min_skill3) ?? "-";
            });

        // ability_item1
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.ability_item1);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "4.3em")
            .text(function(d) {
                return getItemText(d.data.ability_item1) ?? "-";
            });

        // ability_item2
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.ability_item2);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "3.3em")
            .text(function(d) {
                return getItemText(d.data.ability_item2) ?? "-";
            });

        // ability_item3
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.ability_item3);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "2.3em")
            .text(function(d) {
                return getItemText(d.data.ability_item3) ?? "-";
            });

        // ability_item4
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.ability_item4);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "1.3em")
            .text(function(d) {
                return getItemText(d.data.ability_item4) ?? "-";
            });

        // money
        node.append("text")
            .attr("class", "money-text")
            .attr("x", function(d) {
                return d.x;
            })
            .attr("y", function(d) {
                return height - d.y;
            })
            .attr("dy", "5.6em")
            .text(function(d) {
                return d.data.money ?? "-";
            });

        function getItemRarity(itemName) {
            if (itemName === undefined)
                return "info-text";
            if (itemName && itemName.length < 2)
                return "info-text";
            switch (itemName.substring(0, 2)) {
                case '&c':
                    return "item-text-common";
                case '&u':
                    return "item-text-uncommon";
                case '&r':
                    return "item-text-rare";
                case '&e':
                    return "item-text-epic";
                case '&l':
                    return "item-text-legendary";
                case '&m':
                    return "item-text-mythic";
                case '&d':
                    return "item-text-divine";
                case '&s':
                    return "item-text-special";
                case '&v':
                    return "item-text-very-special";
                default:
                    return "info-text";
            }
        }

        function getItemText(itemName) {
            if (itemName === undefined)
                return itemName;
            if (itemName && itemName.length < 2)
                return itemName;
            if (itemName[0] == '&') {
                return itemName.substring(2);
            } else {
                return itemName;
            }
        }
    </script>
</body></html>
