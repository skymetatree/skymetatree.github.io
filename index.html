<!doctype html>
<html>

<head>
    <title>SkyBlock Meta Tree</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
    <header>
        <div class="nav-bar">
            <nav>
                <ul>
                    <li><a href="https://github.com/skymetatree/skymetatree.github.io">> GitHub Page</a> </li>
                    <li><a href="https://hypixel.net/threads/github-io-website-skymetatree.5052793/">> Hypixel Forum Post</a> </li>
                    <li><a href="https://github.com/skymetatree/skymetatree.github.io/discussions/categories/new-data">> Submit Data via GitHub Discussions</a> </li>
                </ul>
            </nav>
        </div>
    </header>
    <svg id="canvas"></svg>
    <script>
        // meta tree data

        const data = {
            "name": "New Profile",
            "money": "Wheat - 30k/h ???",
            "cost": "0 coins",
            "children": [{
                "name": "Rookie",
                "helmet": "&cFarmer Suit",
                "chestplate": "&cFarmer Suit",
                "leggings": "&cFarmer Suit",
                "boots": "&cFarmer Suit",
                "pet": "&cBee",
                "main_weapon": "&cUndead Sword",
                "ability_item1": "&cIron Pickaxe",
                "ability_item2": "&cRookie Hoe",
                "money": "Wheat - 40k/h ???",
                "cost": "6k",
                "children": [{
                    "name": "Fighter",
                    "helmet": "&uSquire Armor",
                    "chestplate": "&uSquire Armor",
                    "leggings": "&uSquire Armor",
                    "boots": "&uSquire Armor",
                    "pet": "&cBee",
                    "main_weapon": "&uSquire Sword",
                    "min_skill1": "Combat 5",
                    "min_skill2": "-",
                    "min_skill3": "70 Fairy Souls",
                    "ability_item1": "&uRadiant Power Orb",
                    "ability_item2": "&uWand of Healing",
                    "money": "???",
                    "cost": "45k",
                    "children": [{
                        "name": "Kuudra",
                        "children": [{
                            "name": "t1 Cannonier",
                            "children": [{
                                "name": "t2 Cannonier",
                            }],
                        }, {
                            "name": "t1 Mage",
                            "children": [{
                                "name": "t2 Mage",
                            }, {
                                "name": "t2 Archer",
                            }],
                        }],
                    }, {
                        "name": "Slayer - t1 Rev",
                        "helmet": "&uSquire Armor",
                        "chestplate": "&uSquire Armor",
                        "leggings": "&uSquire Armor",
                        "boots": "&uSquire Armor",
                        "pet": "Bee",
                        "main_weapon": "&uSquire Sword",
                        "min_skill1": "Combat 5",
                        "min_skill3": "70 Fairy Souls",
                        "money": "???",
                        "cost": "17k",
                        "children": [{
                            "name": "t2 Rev",
                            "helmet": "&uSquire Armor",
                            "chestplate": "&uSquire Armor",
                            "leggings": "&uSquire Armor",
                            "boots": "&uSquire Armor",
                            "pet": "Bee",
                            "main_weapon": "&uSquire Sword",
                            "min_skill1": "Combat 10",
                            "min_skill3": "100 Fairy Souls",
                            "ability_item1": "&uWand of Healing",
                            "money": "???",
                            "cost": "23k",
                            "children": [{
                                "name": "t3 Rev",
                                "children": [{
                                    "name": "t4 Rev",
                                    "children": [{
                                        "name": "t5 Rev",
                                    }],
                                }],
                            }, {
                                "name": "t1 Tara",
                                "children": [{
                                    "name": "t2 Tara",
                                    "children": [{
                                        "name": "t3 Tara",
                                        "children": [{
                                            "name": "t4 Tara",
                                        }],
                                    }, {
                                        "name": "t1 Sven",
                                        "children": [{
                                            "name": "t2 Sven",
                                            "children": [{
                                                "name": "t3 Sven",
                                                "children": [{
                                                    "name": "t4 Sven",
                                                    "children": [{
                                                        "name": "t1 Voidgloom",
                                                        "children": [{
                                                            "name": "t2 Voidgloom",
                                                            "children": [{
                                                                "name": "t3 Voidgloom",
                                                                "helmet": "&lAncient Final Dest. 10k",
                                                                "chestplate": "&lAncient Final Dest. 10k",
                                                                "leggings": "&lAncient Final Dest. 10k",
                                                                "boots": "&lAncient Final Dest. 10k",
                                                                "pet": "&e[Lvl 100] Enderman",
                                                                "main_weapon": "&eFabled Vorpal Katana",
                                                                "min_skill1": "Skill Average 40",
                                                                "min_skill2": "Zombie Slayer 8",
                                                                "min_skill3": "235 Fairy Souls",
                                                                "ability_item1": "&mSuspicious Astraea 5✪",
                                                                "ability_item2": "&eOverflux Power Orb",
                                                                "ability_item3": "&lWand of Atonement",
                                                                "ability_item4": "&eWither Cloak Sword",
                                                                "money": "Null Sphere, etc. - 200k/h ???",
                                                                "cost": "1.2b",
                                                                "children": [{
                                                                    "name": "t4 Voidgloom",
                                                                    "helmet": "&mAncient Final Dest. 25k",
                                                                    "chestplate": "&mAncient Final Dest. 25k",
                                                                    "leggings": "&mAncient Final Dest. 25k",
                                                                    "boots": "&mAncient Final Dest. 25k",
                                                                    "pet": "&e[Lvl 100] Enderman",
                                                                    "main_weapon": "&mFabled Atomsplit Katana",
                                                                    "min_skill1": "Skill Average 40",
                                                                    "min_skill2": "Zombie Slayer 8",
                                                                    "min_skill3": "235 Fairy Souls",
                                                                    "ability_item1": "&mSuspicious Astraea 5✪",
                                                                    "ability_item2": "&eOverflux Power Orb",
                                                                    "ability_item3": "&lWand of Atonement",
                                                                    "ability_item4": "&eWither Cloak Sword",
                                                                    "money": "Judgement Core, etc. - 3m/h ???",
                                                                    "cost": "1.3b",
                                                                }, {
                                                                    "name": "t1 Inferno",
                                                                    "children": [{
                                                                        "name": "t2 Inferno",
                                                                        "children": [{
                                                                            "name": "t3 Inferno",
                                                                            "children": [{
                                                                                "name": "t4 Inferno",
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],

                            }]
                        }]
                    }, {
                        "name": "Spider Fighter",
                        "children": [{
                            "name": "Ender Fighter",
                            "children": [{
                                "name": "Zealot Fighter",
                                "helmet": "&eEnder Armor",
                                "chestplate": "&eEnder Armor",
                                "leggings": "&eEnder Armor",
                                "boots": "&eEnder Armor",
                                "pet": "&eEnderman",
                                "main_weapon": "&rRaiders Axe",
                                "min_skill1": "Combat 15",
                                "min_skill3": "120 Fairy Souls",
                                "min_skill4": "100 MP - Warrior",
                                "ability_item1": "&uRadiant Power Orb",
                                "ability_item2": "&uWand of Healing",
                                "ability_item3": "-",
                                "ability_item4": "-",
                                "money": "???",
                                "cost": "???",
                                "children": [{
                                    "name": "Zealot Farmer",
                                    "helmet": "&lWise Young Dragon",
                                    "chestplate": "&lWise Young Dragon",
                                    "leggings": "&lWise Young Dragon",
                                    "boots": "&lWise Young Dragon",
                                    "pet": "&eEnderman",
                                    "main_weapon": "&rAspect of the End",
                                    "min_skill1": "Combat 15",
                                    "min_skill3": "180 Fairy Souls",
                                    "min_skill4": "100 MP - Warrior",
                                    "ability_item1": "&uRadiant Power Orb",
                                    "ability_item2": "&uWand of Healing",
                                    "ability_item3": "-",
                                    "ability_item4": "-",
                                    "money": "Sum Eyes - 3m/h",
                                    "cost": "???",
                                    "children": [{
                                        "name": "Zealot Sniper",
                                    }],
                                }],
                            }, {
                                "name": "Crystal Frag Leecher",
                                "helmet": "&eEnder Armor",
                                "chestplate": "&eEnder Armor",
                                "leggings": "&eEnder Armor",
                                "boots": "&eEnder Armor",
                                "pet": "&eEnderman",
                                "main_weapon": "&lRunaans Bow",
                                "min_skill1": "Combat 15",
                                "min_skill3": "120 Fairy Souls",
                                "ability_item1": "&uRadiant Power Orb",
                                "ability_item2": "&uWand of Healing",
                                "ability_item3": "-",
                                "ability_item4": "-",
                                "money": "Crystal Fragments - 400k/h ???",
                                "cost": "???",
                                "children": [{
                                    "name": "Dragon Fighter",
                                    "children": [{
                                        "name": "E-Drag Farmer",
                                    }],
                                }],
                            }],
                        }],
                    }, {
                        "name": "Dungeoneer",
                        "helmet": "&eEnder Armor",
                        "chestplate": "&eEnder Armor",
                        "leggings": "&eEnder Armor",
                        "boots": "&eEnder Armor",
                        "pet": "&eEnderman",
                        "main_weapon": "&rRaiders Axe",
                        "min_skill1": "Combat 15",
                        "min_skill3": "120 Fairy Souls",
                        "ability_item1": "&uRadiant Power Orb",
                        "ability_item2": "&uWand of Healing",
                        "ability_item3": "&cEnder Pearls",
                        "ability_item4": "-",
                        "money": "Free Books - 100k/h ???",
                        "cost": "???",
                        "children": [{
                            "name": "f1 Healer",
                            "helmet": "&rEmpowered Mender Helmet",
                            "chestplate": "&eEmpowered Zombie Soldier",
                            "leggings": "&eEmpowered Zombie Soldier",
                            "boots": "&eEmpowered Zombie Soldier",
                            "pet": "&e[Lvl 30] Ghoul",
                            "main_weapon": "&rAspect of the End",
                            "min_skill1": "Combat 18",
                            "min_skill2": "-",
                            "min_skill3": "185 Fairy Souls",
                            "ability_item1": "&uRadiant Power Orb",
                            "ability_item2": "&uWand of Healing",
                            "ability_item3": "&rSpirit Leap",
                            "ability_item4": "&eOrnate Zombie Sword",
                            "money": "???",
                            "cost": "1m",
                            "children": [{
                                "name": "f2 Healer",
                                "children": [{
                                    "name": "f3 Healer",
                                    "children": [{
                                        "name": "f4 Healer",
                                        "children": [{
                                            "name": "f5 Healer",
                                            "children": [{
                                                "name": "f6 Healer",
                                                "children": [{
                                                    "name": "f7 Healer",
                                                    "children": [{
                                                        "name": "m1 Healer",
                                                        "children": [{
                                                            "name": "m2 Healer",
                                                            "children": [{
                                                                "name": "m3 Healer",
                                                                "cost": "< play Tank instead >",
                                                                "children": [{
                                                                    "name": "m4 Healer",
                                                                    "children": [{
                                                                        "name": "m5 Healer",
                                                                        "cost": "< play Tank instead >",
                                                                        "children": [{
                                                                            "name": "m6 Healer",
                                                                            "children": [{
                                                                                "name": "m7 Healer"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }, {
                            "name": "f1 Mage",
                            "helmet": "&lWise Young Dragon",
                            "chestplate": "&lWise Young Dragon",
                            "leggings": "&lWise Young Dragon",
                            "boots": "&lWise Young Dragon",
                            "pet": "< any >",
                            "main_weapon": "&lAspect of the Dragons",
                            "min_skill1": "Combat 18",
                            "min_skill2": "-",
                            "min_skill3": "185 Fairy Souls",
                            "ability_item1": "&uRadiant Power Orb",
                            "ability_item2": "&uWand of Healing",
                            "ability_item3": "&cEnder Pearls",
                            "ability_item4": "&rAspect of the End",
                            "money": "???",
                            "cost": "1.5m",
                            "children": [{
                                "name": "f2 Mage",
                                "children": [{
                                    "name": "f3 Mage",
                                    "children": [{
                                        "name": "f4 Mage",
                                        "children": [{
                                            "name": "f5 Mage",
                                            "children": [{
                                                "name": "f6 Mage",
                                                "children": [{
                                                    "name": "f7 Mage",
                                                    "children": [{
                                                        "name": "m1 Mage",
                                                        "children": [{
                                                            "name": "m2 Mage",
                                                            "children": [{
                                                                "name": "m3 Mage",
                                                                "cost": "< play Berserk instead >",
                                                                "children": [{
                                                                    "name": "m4 Mage",
                                                                    "children": [{
                                                                        "name": "m5 Mage",
                                                                        "cost": "< play Berserk instead >",
                                                                        "children": [{
                                                                            "name": "m6 Mage",
                                                                            "children": [{
                                                                                "name": "m7 Mage"
                                                                            }]
                                                                        }, {
                                                                            "name": "m6 'Fake' Mage",
                                                                            "children": [{
                                                                                "name": "m7 'Fake' Mage"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }, {
                            "name": "f1 Berserk",
                            "children": [{
                                "name": "f2 Berserk",
                                "children": [{
                                    "name": "f3 Berserk",
                                    "children": [{
                                        "name": "f4 Berserk",
                                        "children": [{
                                            "name": "f5 Berserk",
                                            "children": [{
                                                "name": "f6 Berserk",
                                                "children": [{
                                                    "name": "f7 Berserk",
                                                    "children": [{
                                                        "name": "m1 Berserk",
                                                        "children": [{
                                                            "name": "m2 Berserk",
                                                            "children": [{
                                                                "name": "m3 Berserk",
                                                                "children": [{
                                                                    "name": "m4 Berserk",
                                                                    "children": [{
                                                                        "name": "m5 Berserk",
                                                                        "children": [{
                                                                            "name": "m6 Berserk",
                                                                            "children": [{
                                                                                "name": "m7 Berserk"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }, {
                            "name": "f1 Archer",
                            "children": [{
                                "name": "f2 Archer",
                                "children": [{
                                    "name": "f3 Archer",
                                    "children": [{
                                        "name": "f4 Archer",
                                        "children": [{
                                            "name": "f5 Archer",
                                            "children": [{
                                                "name": "f6 Archer",
                                                "children": [{
                                                    "name": "f7 Archer",
                                                    "children": [{
                                                        "name": "m1 Archer",
                                                        "children": [{
                                                            "name": "m2 Archer",
                                                            "children": [{
                                                                "name": "m3 Archer",
                                                                "children": [{
                                                                    "name": "m4 Archer",
                                                                    "children": [{
                                                                        "name": "m5 Archer",
                                                                        "children": [{
                                                                            "name": "m6 Archer",
                                                                            "children": [{
                                                                                "name": "m7 Archer"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }, {
                            "name": "f1 Tank",
                            "children": [{
                                "name": "f2 Tank",
                                "children": [{
                                    "name": "f3 Tank",
                                    "children": [{
                                        "name": "f4 Tank",
                                        "children": [{
                                            "name": "f5 Tank",
                                            "children": [{
                                                "name": "f6 Tank",
                                                "children": [{
                                                    "name": "f7 Tank",
                                                    "children": [{
                                                        "name": "m1 Tank",
                                                        "children": [{
                                                            "name": "m2 Tank",
                                                            "children": [{
                                                                "name": "m3 Tank",
                                                                "children": [{
                                                                    "name": "m4 Tank",
                                                                    "children": [{
                                                                        "name": "m5 Tank",
                                                                        "helmet": "&mGiant Reaper Mask 5✪",
                                                                        "chestplate": "&mGiant Goldor's Armor 6✪",
                                                                        "leggings": "&mGiant Goldor's Armor 5✪",
                                                                        "boots": "&mGiant Goldor's Armor 5✪",
                                                                        "pet": "&l[Lvl 100] Blue Whale",
                                                                        "main_weapon": "&mSuspicious Astraea 5✪",
                                                                        "min_skill1": "Skill Average 40",
                                                                        "min_skill2": "Zombie Slayer 8",
                                                                        "min_skill3": "235 Fairy Souls",
                                                                        "ability_item1": "&lFabled Soul Whip 5✪",
                                                                        "ability_item2": "&eOverflux Power Orb",
                                                                        "ability_item3": "&l⚚ Precise Last Breath 5✪",
                                                                        "ability_item4": "&eWither Cloak Sword",
                                                                        "money": "Master Star, CP & Potions - 1m/h ???",
                                                                        "cost": "1.3b",
                                                                        "children": [{
                                                                            "name": "m6 Tank",
                                                                            "children": [{
                                                                                "name": "m7 Tank"
                                                                            }],
                                                                        }],
                                                                    }],
                                                                }],
                                                            }],
                                                        }],
                                                    }],
                                                }],
                                            }],
                                        }],
                                    }],
                                }],
                            }],
                        }],
                    }]
                }, {
                    "name": "Gatherer",
                    "helmet": "&cFarmer",
                    "chestplate": "&cFarmer",
                    "leggings": "&cFarmer",
                    "boots": "&cFarmer",
                    "pet": "&cBee",
                    "main_weapon": "&cUndead Sword",
                    "min_skill3": "70 Fairy Souls",
                    "ability_item1": "&uDiamond Pickaxe",
                    "ability_item2": "&cRookie Hoe",
                    "money": "???",
                    "cost": "???",
                    "children": [{
                        "name": "Miner",
                        "children": [{
                            "name": "Mithril Miner"
                        }],
                    }, {
                        "name": "Farmer",
                        "children": [{
                            "name": "Sugarcane Farmer"
                        }],
                    }]
                }, {
                    "name": "Fisher",
                    "children": [{
                        "name": "Fisher",
                        "children": [{
                            "name": "Fisher",
                            "children": [{
                                "name": "Fisher",
                                "children": [{
                                    "name": "Fisher",
                                }],
                            }],
                        }],
                    }],
                }]
            }]
        };

        // variables to alter appearance

        const boxSize = 115; // TODO how does boxSize play into all those constants?
        const extraBoxWidth = 115; // TODO how does extraBoxWidth play into all those constants?
        const separation_ratio = 1.5; // TODO how does separation_ratio play into all those constants?

        // initialize svg, width and height

        const svg = d3.select("svg");
        const width = document.body.clientWidth;
        const height = document.body.clientHeight;

        // calculate diagram layout

        const root = d3.hierarchy(data);
        const nodes = root.descendants();
        const treeLayout = d3.tree()
            .nodeSize([boxSize + extraBoxWidth + boxSize / 5, boxSize + boxSize / 4 * 3]) // TODO what do those constants do?
            .separation(function(a, b) {
                return (a.parent == b.parent ? 1 : separation_ratio);
            });
        const links = treeLayout(root).links();


        // figure out size of the tree to calculate window fitting scale
        const x_positions = nodes.map(function(d) {
            return d.x;
        }).sort();
        const diagram_width = Math.abs(x_positions[x_positions.length - 1] - x_positions[0]);
        const y_positions = nodes.map(function(d) {
            return d.y;
        }).sort();
        const diagram_height = Math.abs(y_positions[y_positions.length - 1] - y_positions[0]);

        const x_scale = (width / diagram_width) * 0.3; // TODO why 0.3
        const y_scale = (height / diagram_height) * 0.2; // TODO why 0.2
        const scale = Math.min(x_scale, y_scale);

        // TODO problems with the x adjustment on wide screeens
        console.log("smallest x:     " + x_positions[0]);
        console.log("diagram_width:  " + diagram_width);
        console.log("client_width:   " + width);
        console.log("scale x:        " + x_scale);
        console.log("");
        console.log("smallest y:     " + y_positions[0]);
        console.log("diagram_height: " + diagram_height);
        console.log("client_height:  " + height);
        console.log("scale y:        " + y_scale);
        console.log("");
        console.log("scale:          " + scale);

        const width_left_diag_wing = Math.abs(x_positions[0] - boxSize - extraBoxWidth / 2);
        const width_right_diag_wing = Math.abs((diagram_width - width_left_diag_wing));
        const diag_left_to_right_factor = (width_left_diag_wing / (width_left_diag_wing + width_right_diag_wing));

        // graphic objects

        const zoomG = svg
            .attr("width", window.screen.width * 3)
            .attr("height", window.screen.height * 3)
            .append("g")
            .attr("class", "zoomG")
            .attr("transform", "translate(" + 0 + "," + 0 + ") scale (" + scale + ")");

        const g = zoomG.append("g")
            .attr("transform", "translate(" + (width * diag_left_to_right_factor * (1 / x_scale)) + "," + 0 + ")");
        // x * (1 / scale), (diagram_height) * (1 / scale)
        // x: 605, 373
        // y: 333, 248

        var first = true;
        svg.call(d3.zoom().on("zoom", function(d) {
            if (first) {
                d.transform.k = d.transform.k * scale;
                first = false;
            }
            zoomG.attr("transform", d.transform);
        }));
        // TODO fix first drag like first zoom is fixed above


        // draw the diagram

        const horizontal_flip_constant = diagram_height * 4.5; //// TODO why 4.5???

        // paths
        const linkPathGenerator = d3.linkVertical()
            .x(function(d) {
                return d.x;
            })
            .y(function(d) {
                return horizontal_flip_constant - d.y;
            });
        g.selectAll("path").data(links)
            .enter().append("path")
            .attr("d", linkPathGenerator);

        // node
        const rectSize = boxSize;
        var node = g.selectAll(".node").data(nodes).enter();

        // boxes
        node.append("rect")
            .attr("class", "box")
            .attr("rx", rectSize / 15)
            .attr("width", rectSize + extraBoxWidth)
            .attr("height", rectSize)
            .attr("transform", function(d) {
                return "translate(" + (d.x - (rectSize + extraBoxWidth) / 2) + "," + (horizontal_flip_constant - d.y - rectSize / 2) + ")";
            });

        // text
        node.append("text")
            .attr("class", "title")
            .attr("x", function(d) {
                return d.x;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "-2.2em")
            .text(function(d) {
                return d.data.name;
            });

        // helmet
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.helmet);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "-2.7em")
            .text(function(d) {
                return getItemText(d.data.helmet) ?? "-";
            });

        // chestplate
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.chestplate);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "-1.7em")
            .text(function(d) {
                return getItemText(d.data.chestplate) ?? "-";
            });

        // leggings
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.leggings);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "-0.7em")
            .text(function(d) {
                return getItemText(d.data.leggings) ?? "-";
            });

        // boots
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.boots);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "0.3em")
            .text(function(d) {
                return getItemText(d.data.boots) ?? "-";
            });

        // pet
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.pet);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "2.3em")
            .text(function(d) {
                return getItemText(d.data.pet) ?? "-";
            });

        // main_weapon
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.main_weapon);
            })
            .attr("x", function(d) {
                return d.x - (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "4.3em")
            .text(function(d) {
                return getItemText(d.data.main_weapon) ?? "-";
            });

        // min_skill1
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.min_skill1);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "-2.7em")
            .text(function(d) {
                return getItemText(d.data.min_skill1) ?? "-";
            });

        // min_skill2
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.min_skill2);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "-1.7em")
            .text(function(d) {
                return getItemText(d.data.min_skill2) ?? "-";
            });

        // min_skill3
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.min_skill3);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "-0.7em")
            .text(function(d) {
                return getItemText(d.data.min_skill3) ?? "-";
            });

        // min_skill4
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.min_skill4);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "0.3em")
            .text(function(d) {
                return getItemText(d.data.min_skill4) ?? "-";
            });


        // ability_item1
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.ability_item1);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "4.3em")
            .text(function(d) {
                return getItemText(d.data.ability_item1) ?? "-";
            });

        // ability_item2
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.ability_item2);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "3.3em")
            .text(function(d) {
                return getItemText(d.data.ability_item2) ?? "-";
            });

        // ability_item3
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.ability_item3);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "2.3em")
            .text(function(d) {
                return getItemText(d.data.ability_item3) ?? "-";
            });

        // ability_item4
        node.append("text")
            .attr("class", function(d) {
                return getItemRarity(d.data.ability_item4);
            })
            .attr("x", function(d) {
                return d.x + (boxSize + extraBoxWidth) / 4;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "1.3em")
            .text(function(d) {
                return getItemText(d.data.ability_item4) ?? "-";
            });

        // money
        node.append("text")
            .attr("class", "money-text")
            .attr("x", function(d) {
                return d.x;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "5.6em")
            .text(function(d) {
                return d.data.money ?? "-";
            });

        // cost
        node.append("text")
            .attr("class", "money-text")
            .attr("x", function(d) {
                return d.x;
            })
            .attr("y", function(d) {
                return horizontal_flip_constant - d.y;
            })
            .attr("dy", "6.6em")
            .text(function(d) {
                return d.data.cost ?? "-";
            });

        function getItemRarity(itemName) {
            if (itemName === undefined)
                return "info-text";
            if (itemName && itemName.length < 2)
                return "info-text";
            switch (itemName.substring(0, 2)) {
                case '&c':
                    return "item-text-common";
                case '&u':
                    return "item-text-uncommon";
                case '&r':
                    return "item-text-rare";
                case '&e':
                    return "item-text-epic";
                case '&l':
                    return "item-text-legendary";
                case '&m':
                    return "item-text-mythic";
                case '&d':
                    return "item-text-divine";
                case '&s':
                    return "item-text-special";
                case '&v':
                    return "item-text-very-special";
                default:
                    return "info-text";
            }
        }

        function getItemText(itemName) {
            if (itemName === undefined)
                return itemName;
            if (itemName && itemName.length < 2)
                return itemName;
            if (itemName[0] == '&') {
                return itemName.substring(2);
            } else {
                return itemName;
            }
        }
    </script>
</body></html>
